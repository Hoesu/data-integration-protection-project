# 위험도 계산 방식 합리성 검토

## 발견된 문제점

### 1. IDR 계산의 한계

**현재 구현:**
```python
IDR_i = 1 / (1 + S_i)
```
여기서 S_i는 노드 i에 연결된 모든 엣지의 가중치 합입니다.

**문제점:**
- 연결 수와 가중치를 구분하지 못함
- 예: S_i = 2.0인 경우
  - 연결 2개 (각 가중치 1.0) → IDR = 0.33
  - 연결 20개 (각 가중치 0.1) → IDR = 0.33 (동일)
- 연결 수가 많으면 위험이 낮아야 하는데, 현재는 가중치 합만으로 판단

**개선 제안:**
```python
# 옵션 1: 연결 수와 가중치를 모두 고려
IDR_i = 1 / (1 + S_i / k_i)  # 평균 가중치 기반

# 옵션 2: 연결 수에 더 큰 가중치
IDR_i = 1 / (1 + S_i + k_i)  # 연결 수와 가중치 합 모두 고려

# 옵션 3: 현재 방식 유지하되 스케일 조정
IDR_i = 1 / (1 + S_i / max_possible_S)  # 정규화된 가중치 합
```

### 2. ADR 계산의 심각한 문제

**현재 구현:**
```python
ADR_i = 1 / (S_i(k_i-1)) * sum_{j≠i, k≠i,j} ((w_ij + w_ik)/2 * a_jk * w_jk)
```

**문제점:**

1. **w_jk를 곱하는 것이 과도함**
   - 표준 weighted clustering coefficient는 `(w_ij + w_ik)/2 * a_jk`까지만 사용
   - `w_jk`를 추가로 곱하면 j-k 간 연결 강도가 과도하게 반영됨
   - 예: `(w_ij + w_ik)/2 = 0.5`, `w_jk = 0.9` → 기여도 = 0.45
   - 하지만 `w_jk = 0.1`이면 → 기여도 = 0.05 (10배 차이)
   - 이는 삼각관계의 밀집도를 측정하는 목적과 맞지 않을 수 있음

2. **정규화 기준이 불명확**
   - 분모 `S_i * (k_i - 1)`는 표준 weighted clustering coefficient의 정규화
   - 하지만 분자에 `w_jk`가 곱해져 있어 스케일이 일관되지 않음
   - ADR 값의 범위가 예측하기 어려움

3. **의미 해석의 어려움**
   - 표준 clustering coefficient는 0~1 범위의 명확한 해석 가능
   - 현재 수식은 그렇지 않음

**개선 제안:**

```python
# 옵션 1: 표준 weighted clustering coefficient 사용
ADR_i = 1 / (S_i(k_i-1)) * sum_{j≠i, k≠i,j} ((w_ij + w_ik)/2 * a_jk)
# w_jk 제거 - 삼각관계 존재 여부만 중요

# 옵션 2: w_jk를 제곱근으로 완화
ADR_i = 1 / (S_i(k_i-1)) * sum_{j≠i, k≠i,j} ((w_ij + w_ik)/2 * a_jk * sqrt(w_jk))
# w_jk의 영향 완화

# 옵션 3: 현재 방식 유지하되 정규화 개선
# 분모를 조정하여 0~1 범위로 정규화
```

### 3. MDR 계산 방법

**현재 제공 방법:**
- `max`: 한 위험만 반영 (정보 손실)
- `normalized_sum`: 두 위험 모두 반영 (추천)
- `normalized_weighted_avg`: 가중치 필요 (주관적)
- `geometric_mean`: 두 위험 모두 높을 때만 높음

**권장사항:**
- `normalized_sum` 방법이 가장 합리적
- 두 위험을 모두 반영하면서 가중치 선택의 주관성 제거

## 권장 개선 사항

### 우선순위 1: ADR 계산 수정
- `w_jk` 제거 또는 완화
- 표준 weighted clustering coefficient와 비교 검증

### 우선순위 2: IDR 계산 개선
- 연결 수를 고려한 개선 방안 검토
- 현재 방식도 합리적이지만 개선 여지 있음

### 우선순위 3: 검증
- 실제 데이터에서 위험도 분포 확인
- 이상치나 비정상적인 값 발생 여부 확인

> 현재 코드는 옵션 1(평균 가중치 기반 IDR, w_jk 제거 ADR, 기본 MDR = normalized_sum)이 반영된 상태이며, 이 문서는 초기 설계에 대한 회고용 기록입니다.